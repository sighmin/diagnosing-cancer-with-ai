#!/usr/bin/env ruby

require_relative '../lib/intelligence'
include Intelligence

options = {
  layers: [{
    size: 30,
    bias: true,
    function: nil
  },{
    size: 7,
    bias: true,
    function: :sigmoid
  },{
    size: 1,
    bias: false,
    function: :sigmoid
  }]
}
# 94%
#fitness = 0.07313633103336281
weights = [-0.8401399256017892, 3.0186318231731555, -0.8706663226442846, 0.9589826048508336, -1.9290864766930305, -2.6879400189234692, -4.324727986284202, 0.0014664251371376835, 5.720911195428775, -0.847992832953706, 9.103622644929487, -6.091102825293548, 7.840268913624734, 3.5661292525776638, 1.9212093125145249, 2.6267333397817745, 0.4978275443781409, 2.807477116382393, -3.7208480043621788, -3.8540659196463647, -1.0832208559759082, -8.255324981565742, -5.787081450126141, 1.7451711225086288, 2.285277084177658, 4.170109673656685, 0.36835200930788303, 2.575583637490702, 4.041754838500838, 6.6596710011437015, 2.4862699609053838, -1.6218731509100006, -9.83571079452208, 3.694565750443041, 2.4274569947273448, 3.272306736296149, -1.5568211701690278, -1.01243917393896, -6.0502872303995225, 4.401096822734031, -1.879557052727305, -3.6682115578455, -4.863455179135604, 4.391289464286293, 1.456163155548336, 2.0820917601833164, 1.1384319940037217, -7.734319552938502, -0.5679703665768269, -1.892690546715241, 2.512544631767312, -9.531728317824111, 1.073172754530527, -3.3649853571548416, 2.9910504256863857, -0.015073971348226328, 1.5152337664428774, -2.6710276071965553, -5.3013708297925515, -0.3068456475010105, -3.3708544581970923, -0.8220460121046829, -0.7767834989957051, -6.173013539012139, -4.769175287948348, 2.798408726804654, -1.451668279566031, 4.2542357472558825, -5.105121993149904, 1.4403454200318015, -3.0066408398562947, -3.3073001944182785, -0.6083673872965333, 3.80802786756216, 1.1931350706096988, 4.282192004888002, 0.8287671080439859, 5.984937413270413, -0.7747649213633782, 1.7970808382507268, -0.04739615331203911, 0.18046863597009488, 0.5381274556403647, 2.7890863579747354, -0.3418339317355524, 1.2948332176089075, -1.247317997026406, -0.0103866794977088, 4.731111399395202, -3.374004243790628, 7.319911256423382, 4.551144751632803, -6.635840162685855, 7.699403185551845, 1.519113604856409, 3.3342874401000944, -0.8579800023584225, 4.2322412582716105, -0.16903118700061248, 4.745929355269376, -5.673384223368168, 1.879125154329806, -2.906352680744318, 5.48299213246996, -7.004355929262368, 6.417089770159584, 9.27087993006233, -7.264160059024038, -1.9224643321983925, 2.8435776583121077, 0.41769911471406135, -7.829255596270774, 3.972747502019874, 1.6941849763628287, 3.2223159353517628, -6.647066159082115, 3.2422915527761207, 2.172394391952333, -0.7236265039413292, 6.0008670677748706, -1.3694586207289472, 1.5706975317697958, 8.381336111137134, -1.0946992754104015, -2.0392645544150914, 0.842074184912196, 3.8871270470193546, -5.245455519152721, -3.9317198668458895, 2.8760116148127124, 0.3903878023511013, -2.4618692140761107, -0.5070746412485321, -4.006044781828244, 6.379919414058829, 1.907892232804672, 1.5283159503612294, -0.00916205235953732, 4.0307209279043, -0.49304690659502615, -11.497354504171216, 1.6980815721943807, 1.7511174793930122, 4.910317104019461, -7.587834872886167, 1.9314253404749224, -1.7519033270127657, 4.127418280618973, 1.0093588628439327, 1.4623495943367435, -7.094983445725539, 4.07716620954142, 1.5712962793237413, 5.181858502029866, -2.864329756613987, -0.28528125361620954, -1.2955597218584671, 0.6678692033739293, 5.578787359559929, 4.2629566720989285, -2.638586541519316, -5.292893122102824, -5.162601509004608, -3.591385627291065, 0.33478445728515815, 9.285790767574715, 2.8214757604683656, -1.2271749870317055, 0.09399660778365981, -6.035920675369035, -4.4856193076118895, -0.16549693393721426, -6.531361135409787, -6.055680769089409, -7.883796799990424, -5.506089596491697, -5.700667774613776, 2.597001480959122, -3.7267635391492524, -1.589384321165213, 4.206390049841762, -3.238314749918649, 2.830027345523269, 5.253362289808551, 5.1170539943083675, 2.5769661482050505, 1.4020328651280791, 0.1666024081992748, 5.074344909385655, 1.7978180072690444, 1.905023648413961, -2.7809273026210404, -5.060120407760029, 7.191382018412723, 3.375487916564913, 1.6133627919530085, -4.198297375073565, -0.7110234348693105, 0.4221116340624659, 1.5189984665563934, 1.1908015415693831, -2.584350728316956, 1.9182167091515452, 1.4278434714717405, -3.261630550335585, 3.2774025755484306, 3.6960356824553693, -6.551617672513026, 8.036239780141027, -2.9194170035811164, 3.5221009006194466, 0.3951261376018629, -10.252805271346606, -0.8028449381998415, 1.235567725425514, -0.5960896644104658, -2.0468712801497553, -1.4809644103930661, 2.1145134744545, 4.461600201639677, -7.239770850257854, 0.29715536919719265, -1.3981479119853333, 6.830284001618584, 0.16144792505055222] # test pattern
# 92%
#fitness2 = 0.09077966169846369
#weights2 = [-1.4228563917356454, 2.424731053438708, 1.336391863449956, 2.215356459093668, 0.3912444096861799, 1.458858631313889, -2.847352371188609, -0.5362996581546013, -0.7977626107934088, -0.7361194538403076, 1.2968522283999842, -0.19222217929221036, 1.614987180339975, 0.8148494207927479, 2.547308036154902, -0.7501126332366768, 2.264676956341748, -1.0830915379462938, -1.3371291471245637, -2.3344327470409425, -0.7636593279155124, 2.6037603118565724, 2.4987669304575753, -0.04478616515030897, 0.6569360984435236, 1.01354042271952, -0.9746717052723289, 0.1755250523578767, 0.2674296416359121, -0.4954297589831974, 0.15723568440978442, 0.7876355460895964, -1.5313144812073458, 0.1626600740020044, 1.2215926541248487, -0.783694143956776, -1.0414711113202992, 1.8716012099381767, -0.32369419486438583, 0.249832896428525, -2.295581140032881, 1.1498762598035472, -2.0976034166501094, 0.6080467248134394, 0.7663741318525568, -2.5378035966519876, 0.2661375002480938, -1.9842300138290372, -0.6384588403251352, -0.19382732193682822, 2.8315740146333193, 2.212786713864892, -1.1031317222222408, -1.1281524933282097, 0.5259459528679935, 1.7990043882968958, -0.9200435464157091, 0.16750820651084147, 0.09919664986721248, 0.6590978501265057, -0.9606853204687118, 1.318692396687459, 1.3732112726666548, 0.5794559569071569, 0.9525022301064305, 0.5907098297521602, 0.6937277909854094, 1.7723088161604896, -0.6060650355632782, 3.1354542199518933, -0.23832602033163866, 2.379267859743063, -0.6641764966240292, 1.720632460427331, 2.6449185002493305, 0.4386877879573289, 0.6962502722219035, -0.759002566480713, -1.0211995218777776, -0.5487327385948726, 0.44475613015753435, -0.00950519744539563, -0.299469311343955, -0.36323671179553807, 0.9391218969488451, -0.7177399261366373, 0.5715155258419281, 2.07563061648002, -0.031320791113244664, 0.11586424024080227, -0.956584297278165, 1.413301341658812, 0.8923325663921857, 1.6278778329167027, -0.13569112346335682, 0.40214129126544007, -0.31850043297999786, -0.24095958461604822, 0.4913889211893758, 0.14662617357994834, 1.930593046299836, 0.4375066391125017, 0.9720745826910822, 1.5251708557322794, 1.0089062457870166, 0.9123356550255662, -1.4918768814483103, -0.1012886863092291, -0.3867256369234913, -0.9480199855413065, -0.2899541045246348, 3.071520233169328, 1.1790968034450977, 2.0217319104839993, 0.035094841996594545, 1.7500120431080604, -1.6632384516567518, -0.9530791160487938, 0.9561534288625693, 2.321629862715412, -0.7996979816487342, -1.9797557410002473, -0.6877520074650565, 0.638307487150019, 1.0714935635063518, 2.52642901915934, -1.5047672845871367, -1.4149251263509826, -2.970738692403219, 3.7793739532301642, 1.182433211223581, -1.1895890554435666, 0.39576607267493624, 2.054029806992192, 0.7427461139218914, 0.17967281824294873, 2.1731513872145314, 1.8264273221344156, -0.8124515668658964, 1.5704300089134677, 1.5242762264725647, -0.16166535713336255, -1.6589181925278895, -0.6307922586347868, -0.500374556013793, 2.7183889835907884, -1.030904347854596, 0.32523820856306707, -0.6989471211814036, 0.29857157138565393, -1.7942391370157944, 1.6700063673453733, -0.5165478964783015, -0.5545874234839152, -0.691014976375288, -1.808616597251563, -3.5487398037360283, 0.34900460150083357, 0.1013298477243332, 0.07122651955140774, -0.6804949143392247, 0.42014839795272496, -0.9980434947022517, -2.001793086375562, 1.440185676660176, -2.039560902383509, 1.2766321824140625, 3.069447810019828, 1.7977511910404353, -1.5471846463222403, 1.0524986503210432, -1.5337054221512605, -0.6435108006746622, -1.0281007903514643, 0.18135630098074473, 1.3172613636764265, 0.6873996708196356, 2.0025042705722895, -0.7422989146250423, -0.45222706646220445, 1.2844394255180376, 0.9271389745110845, 0.5373794243414741, -2.579824388851169, 1.4238810732465856, 1.1321393675183373, 1.9777147280092295, 0.6687038279155888, 2.272500246496893, 1.6831597987310807, -1.3019081859398582, 1.372703624235095, -0.871734369984602, -0.5292530447608856, 0.6658077850069863, 0.08433839839702453, 3.194268603202899, 2.0066657177881795, -1.9739979671483945, 1.5453892819065107, 0.7649517008126587, 1.0532479316156294, -2.264075711645003, 1.076038228911169, 1.153833657501681, 1.6189426566899043, 1.5194872545802034, -0.7000070498139992, 1.6925010170634764, 1.359228005821283, -1.692489651104741, -1.2494722145909183, 0.4311782928705941, 2.3879636410906713, 1.1913186046350113, -2.858211239966942, -0.4286496385201064, -2.0569801353534505, 1.8047839604279579, 3.3144249021346823, 2.0656697430891375, 1.083841949380544, 2.5711664396168095, -2.2873720823949726, -0.8295377515896838]

net = Nn::NeuralNetwork.new(options) # create network with options
net.weights = weights

# classify pattern
malignant_pattern = [20.6,29.33,140.1,1265,0.1178,0.277,0.3514,0.152,0.2397,0.07016,0.726,1.595,5.772,86.22,0.006522,0.06158,0.07117,0.01664,0.02324,0.006185,25.74,39.42,184.6,1821,0.165,0.8681,0.9387,0.265,0.4087,0.124]
benign_pattern = [7.76,24.54,47.92,181,0.05263,0.04362,0,0,0.1587,0.05884,0.3857,1.428,2.548,19.15,0.007189,0.00466,0,0,0.02676,0.002783,9.456,30.37,59.16,268.6,0.08996,0.06444,0,0,0.2871,0.07039]

puts "Classification: BEFORE"
puts "---"
puts "Expected Malignant, got #{net.classify(malignant_pattern)}"
puts "Expected Benign, got #{net.classify(benign_pattern)}"
puts "---"

# marshal dump it
File.open('save_options', 'w') { |file| file << options.to_json }
File.open('save_weights', 'w') { |file| file << weights.to_json }

# marshal load it
options = JSON.load(File.open('save_options').read).deep_symbolize_keys!
weights = JSON.load(File.open('save_weights').read)

net = Nn::NeuralNetwork.new(options) # create network with options
net.weights = weights

# classify pattern
puts "Classification: AFTER"
puts "---"
puts "Expected Malignant, got #{net.classify(malignant_pattern)}"
puts "Expected Benign, got #{net.classify(benign_pattern)}"
puts "---"

### Are they the same?
